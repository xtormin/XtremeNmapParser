# XNP - Xtreme Nmap Parser
This program extracts the most pertinent information from an **XML file generated by a nmap scan**, then converts it into **CSV or XLSX format**.

This is **particularly useful when tasked with analyzing a large number of hosts** as it enables quicker, more efficient filtering and testing.

For instance, you can:

- Filter based on open ports or services.
- Exclude ports that appear to be open, but are irrelevant for testing.
- Maintain a record of what has been analyzed.
- If a vulnerable service is detected, rapidly search for other potentially vulnerable hosts.
- Copy and paste data of vulnerable hosts, filtered by service version.

## Install

```
git clone https://github.com/xtormin/XtremeNmapParser.git
```

### Python requirements

```
python3 -m pip install -r setup/requirements.txt
```

### Virtual environment

```
sudo apt install python3-venv
```

To create a python virtual environment:

```
python3 -m venv venv
source venv/bin/activate
python3 -m pip install -r setup/requirements.txt
```

## Execution

Example of nmap scan:

```
nmap -T4 -Pn -open --script=default,version,vuln -A -p- -oA nmap/tcp-full-scripts 10.10.1.9
```

### Single XML file

Using the tcp-full-scripts.xml file created, execute this tool:

```
python3 xnp.py -f <nmap XML file> -o <list with output formats>
python3 xnp.py -f nmap/tcp-full-scripts.xml -o csv,xlsx
```

![single_scan.png](utils%2Fimages%2Fsingle_scan.png)

### Folder with multiple XML files

#### Converting XML Files to XLSX/CSV

Each XML file in the specified folder is processed and converted into a DataFrame. 

The following command will produce a CSV/XLSX file for each XML file in the specified folder. The CSV/XLSX will be saved in the same location as the original.


To convert all XML files in a folder, you can use the following command:

```
python3 xnp.py -d <folder with nmap XML files> -o <list with output formats>
python3 xnp.py -d nmap/ -o csv,xlsx
```

![multiple_scans.png](utils%2Fimages%2Fmultiple_scans.png)


#### Merging XML files into a Single XLSX/CSV file

Once each XML file has been converted into a DataFrame, all of the DataFrames can be merged into a single DataFrame.

The following command will produce a single XLSX/CSV file that contains the merged data from all of the XML files in the specified folder.

To merge all nmap XML files and generate a file with the result, you can use the following command:

1. Default output name "merged_nmap_scan_data":
```
python3 xnp.py -d <folder with nmap XML files> -o <list with output formats> -M
python3 xnp.py -d nmap/ -o csv,xlsx -M
```

2. Other output name:
```
python3 xnp.py -d <folder with nmap XML files> -o <list with output formats> -M -O <output name>
python3 xnp.py -d nmap/ -o csv,xlsx -M -O merged_nmap_scan_data
```

![multiple_scans_merged.png](utils%2Fimages%2Fmultiple_scans_merged.png)

Filtering rules are applied to the DataFrame when merging data from multiple XML files. These rules are necessary to remove duplicates and to keep only the most relevant information. The rules are as follows:

1. A column named 'RelevantDuplicate' is added that counts the number of non-null values in the 'Service Name', 'Product', 'Version', and 'Extrainfo' columns for each row.

2. The DataFrame is sorted by 'IP', 'Port', 'State', and 'RelevantDuplicate' (in descending order so that larger counts come first).

3. Duplicates are dropped based on the 'IP' and 'Port' columns, keeping only the first occurrence of each IP-Port pair.

These filtering rules allow for the reduction of data redundancy and the retention of only the most useful and relevant information.

### Output example

You will get the following information:

```
Hostname;IP;State;Port;Protocol;State Port; Service Name; Product; Version; Extrainfo
xtormin.local;10.10.1.9;up;445;tcp;open;microsoft-ds;Windows Server 2016 Standard 14393 microsoft-ds;;
xtormin.local;10.10.1.9;up;1433;tcp;open;ms-sql-s;Microsoft SQL Server 2017;"14.00.1000.00; RTM";
xtormin.local;10.10.1.9;up;3389;tcp;open;ms-wbt-server;Microsoft Terminal Services;;
```